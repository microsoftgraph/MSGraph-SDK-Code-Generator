parameters:
- name: cleanMetadataFolder
  type: string

steps:
- template: /.azure-pipelines/generation-templates/set-user-config.yml@self
- template: /.azure-pipelines/generation-templates/use-dotnet-sdk.yml@self
  parameters:
    version: "9.x" #kiota uses a net9 target

# checkout metadata repo if capture and clean step is skipped
- checkout: msgraph-metadata
  displayName: checkout metadata
  fetchDepth: 1
  persistCredentials: true
  submodules: recursive
  condition: or(eq(variables.skipMetadataCaptureAndClean, true), eq(variables.skipOpenApiCaptureAndClean, true))

- pwsh: |
    md $(Build.SourcesDirectory)/msgraph-metadata/clean_v10_openapi
    md $(Build.SourcesDirectory)/msgraph-metadata/clean_beta_openapi
    Move-Item -Path $(Build.SourcesDirectory)/msgraph-metadata/openapi/v1.0/openapi.yaml -Destination $(Build.SourcesDirectory)/msgraph-metadata/clean_v10_openapi/
    Move-Item -Path $(Build.SourcesDirectory)/msgraph-metadata/openapi/beta/openapi.yaml -Destination $(Build.SourcesDirectory)/msgraph-metadata/clean_beta_openapi/
  displayName: Move metadata to expected location
  condition: or(eq(variables.skipMetadataCaptureAndClean, true), eq(variables.skipOpenApiCaptureAndClean, true))
