# Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.  See License in the project root for license information.
# contains an end to end validation pipeline using C# compilation tests for staging beta metadata

# capture-metadata.yml will result in the capture and cleaning of the metadata
# with the artifacts posted to GitHub.

parameters:
- name: 'endpoint'
  type: string
  default: "v1.0"
- name: 'inputMetadata'
  type: string
  default: $(rawMetadataFileV1)
- name: 'outputPath'
  type: string
  default: $(System.ArtifactsDirectory)
- name: 'docsDirectory'
  type: string
  default: $(docsDirectoryV1)
- name: 'repoName'
  type: string
  default: "msgraph-sdk-dotnet"
- name: 'cleanMetadataFile'
  type: string
  default: $(cleanMetadataFileV1)

steps:

# We only need the scripts
- checkout: self
  displayName: checkout generator
  fetchDepth: 1
  persistCredentials: true

- checkout: microsoft-graph-docs
  displayName: checkout graph docs
  fetchDepth: 1
  persistCredentials: true

- template: checkout-metadata.yml
- template: set-user-config.yml

- task: DotNetCoreCLI@2
  inputs:
    command: 'run'
    projects: $(Build.SourcesDirectory)/msgraph-metadata/tools/MetadataParser/MetadataParser.csproj
    arguments: ${{ parameters.cleanMetadataFile }}
