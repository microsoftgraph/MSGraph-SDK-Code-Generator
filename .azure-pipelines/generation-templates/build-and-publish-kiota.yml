steps:
- bash: |
    RELEASE_JSON=$(curl -s "https://api.github.com/repos/microsoft/kiota/releases/latest")
    LATEST_TAG=$(echo "$RELEASE_JSON" | jq -r '.tag_name')
    ASSET_URL=$(echo "$RELEASE_JSON" | jq -r '.assets[] | select(.name | test("linux-x64")) | .browser_download_url')
    echo "Downloading Kiota $LATEST_TAG"
    echo "Asset URL: $ASSET_URL"
    curl -L "$ASSET_URL" -o kiota_download
    mkdir -p /tmp/kiota_extract
    if [[ "$ASSET_URL" == *.zip ]]; then
      unzip kiota_download -d /tmp/kiota_extract
    else
      tar -xzf kiota_download -C /tmp/kiota_extract
    fi
    KIOTA_BIN=$(find /tmp/kiota_extract -name kiota -type f | head -1)
    echo "Found Kiota binary at: $KIOTA_BIN"
    mkdir -p "$(Build.ArtifactStagingDirectory)"
    cp "$KIOTA_BIN" "$(Build.ArtifactStagingDirectory)/kiota"
  displayName: 'Download latest Kiota from GitHub'
